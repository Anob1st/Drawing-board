<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Drawing Game</title>
<style>
  body {
    background: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: sans-serif;
  }
  #canvas-container {
    margin: 20px;
    padding: 10px;
    background: #222;
    border-radius: 10px;
    box-shadow: 0 0 20px #00ffff;
  }
  canvas {
    border: 2px solid #0ff;
    border-radius: 5px;
    background: #000;
  }
  #controls {
    margin-top: 20px;
    display: flex;
    gap: 15px;
    justify-content: center;
  }
  #controls input, #controls button {
    font-size: 18px;
    padding: 10px;
    border-radius: 8px;
    border: none;
    outline: none;
  }
  #controls button {
    background: #0ff;
    color: #000;
    cursor: pointer;
    box-shadow: 0 0 10px #0ff;
    transition: 0.2s;
  }
  #controls button:hover {
    box-shadow: 0 0 20px #0ff;
  }
  #avatars {
    display: flex;
    gap: 15px;
    margin-top: 15px;
  }
  .avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #0ff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: #000;
    box-shadow: 0 0 10px #0ff;
  }
</style>
</head>
<body>

<h1>Mini Drawing Game</h1>

<div id="canvas-container">
  <canvas id="board" width="800" height="650"></canvas>
</div>

<div id="controls">
  <input type="color" id="color" value="#00ffff">
  <input type="range" id="size" min="1" max="30" value="5">
  <button id="undo">Undo</button>
  <button id="clear">Clear</button>
</div>

<div id="avatars">
  <div class="avatar">A</div>
  <div class="avatar">B</div>
</div>

<script>
const canvas = document.getElementById("board");
const ctx = canvas.getContext("2d");

const color = document.getElementById("color");
const size = document.getElementById("size");
const undoBtn = document.getElementById("undo");
const clearBtn = document.getElementById("clear");

let drawing = false;
let lastX = 0, lastY = 0;
let lastTime = 0;
let history = [];

// Save canvas state for undo
function saveState() {
  const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
  history.push(imgData);
  if(history.length>50) history.shift();
}

// Restore canvas state
function restoreState() {
  if(history.length>0){
    ctx.putImageData(history[history.length-1],0,0);
  } else {
    ctx.clearRect(0,0,canvas.width,canvas.height);
  }
}

// Get position relative to canvas
function getPos(e){
  const rect = canvas.getBoundingClientRect();
  if(e.touches) return {x:e.touches[0].clientX - rect.left, y:e.touches[0].clientY - rect.top};
  return {x:e.offsetX, y:e.offsetY};
}

// Start drawing
function startDraw(pos){
  drawing = true;
  lastX = pos.x;
  lastY = pos.y;
  lastTime = Date.now();
}

// Draw line with noticeable fast-thin / slow-thick
function draw(pos){
  if(!drawing) return;
  const now = Date.now();
  const dt = now - lastTime || 1;
  const dist = Math.sqrt((pos.x-lastX)**2 + (pos.y-lastY)**2);
  const speed = dist/dt;

  const baseSize = parseInt(size.value);
  // Stronger mapping for noticeable effect
  const lineWidth = Math.max(1, Math.min(baseSize*3, baseSize * (2 - speed*0.05)));

  ctx.strokeStyle = color.value;
  ctx.lineWidth = lineWidth;
  ctx.lineCap = "round";
  ctx.beginPath();
  ctx.moveTo(lastX,lastY);
  ctx.lineTo(pos.x,pos.y);
  ctx.stroke();

  lastX = pos.x;
  lastY = pos.y;
  lastTime = now;
}

// Stop drawing
function stopDraw(pos){
  if(!drawing) return;
  draw(pos);
  drawing = false;
  saveState();
}

// Mouse events
canvas.addEventListener("mousedown", e=>startDraw(getPos(e)));
canvas.addEventListener("mousemove", e=>draw(getPos(e)));
canvas.addEventListener("mouseup", e=>stopDraw(getPos(e)));
canvas.addEventListener("mouseout", e=>stopDraw(getPos(e)));

// Touch events
canvas.addEventListener("touchstart", e=>{ e.preventDefault(); startDraw(getPos(e)); });
canvas.addEventListener("touchmove", e=>{ e.preventDefault(); draw(getPos(e)); });
canvas.addEventListener("touchend", e=>stopDraw(lastX,lastY));

// Buttons
undoBtn.onclick = () => { if(history.length>0){ history.pop(); restoreState(); } };
clearBtn.onclick = () => { ctx.clearRect(0,0,canvas.width,canvas.height); saveState(); };
</script>

</body>
</html>
